import { useState } from "react";
import { motion } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

export default function Backbenchers2026App() {
  const [step, setStep] = useState("gate"); // gate -> request-access -> login -> user -> admin
  const [phone, setPhone] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [adminPass, setAdminPass] = useState("");
  const [blocked, setBlocked] = useState({});
  const [pendingAccess, setPendingAccess] = useState([]);
  const [approved, setApproved] = useState({});

  const SYSTEM_PASSWORD = "6 IDIOT";
  const ADMIN_PASSWORD = "ADMIN 2026";

  const key = `${phone}__${email}`;

  function handleAccessRequest() {
    if (!phone || !email) return;
    if (blocked[key]) return;
    if (!pendingAccess.includes(key) && !approved[key]) {
      setPendingAccess([...pendingAccess, key]);
    }
  }

  function handleLogin() {
    if (blocked[key]) return;
    if (password === SYSTEM_PASSWORD && approved[key]) {
      setStep("user");
    } else {
      // permanent block on repeated wrong attempt
      setBlocked({ ...blocked, [key]: true });
    }
  }

  function handleAdminLogin() {
    if (adminPass === ADMIN_PASSWORD) {
      setStep("admin");
    } else {
      // incorrect admin password -> kick and block permanently by admin flag
      setStep("gate");
    }
  }

  function approve(id) {
    setApproved({ ...approved, [id]: true });
    setPendingAccess(pendingAccess.filter((p) => p !== id));
  }

  return (
    <div className="min-h-screen bg-black text-gray-200 font-sans">
      <div className="max-w-6xl mx-auto p-6 space-y-6">
        <motion.h1 initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-4xl font-bold tracking-widest text-center">
          BACKBENCHERS 2026
        </motion.h1>
        <p className="text-center text-sm uppercase tracking-widest">Dark-secure private network</p>

        {step === "gate" && (
          <Card className="bg-zinc-900 border-zinc-800">
            <CardContent className="space-y-4 p-6">
              <h2 className="text-xl font-semibold">Join Request Gate</h2>
              <div className="grid md:grid-cols-2 gap-4">
                <input placeholder="Phone Number" className="bg-black border border-zinc-700 rounded-xl p-3" value={phone} onChange={(e) => setPhone(e.target.value)} />
                <input placeholder="Gmail Account" className="bg-black border border-zinc-700 rounded-xl p-3" value={email} onChange={(e) => setEmail(e.target.value)} />
              </div>
              {blocked[key] && <div className="text-red-500 text-sm">This identity is permanently blocked.</div>}
              <div className="flex gap-3">
                <Button className="rounded-2xl" onClick={() => setStep("login")}>Already Approved? Login</Button>
                <Button className="rounded-2xl" onClick={handleAccessRequest}>Request Access</Button>
                <Button variant="outline" className="rounded-2xl" onClick={() => setStep("admin-login")}>Admin Panel</Button>
              </div>
            </CardContent>
          </Card>
        )}

        {step === "login" && (
          <Card className="bg-zinc-900 border-zinc-800">
            <CardContent className="space-y-4 p-6">
              <h2 className="text-xl font-semibold">Secure Login</h2>
              <input placeholder="System Password" type="password" className="bg-black border border-zinc-700 rounded-xl p-3 w-full" value={password} onChange={(e) => setPassword(e.target.value)} />
              <Button className="rounded-2xl w-full" onClick={handleLogin}>Enter</Button>
            </CardContent>
          </Card>
        )}

        {step === "admin-login" && (
          <Card className="bg-zinc-900 border-zinc-800">
            <CardContent className="space-y-4 p-6">
              <h2 className="text-xl font-semibold">Admin Authentication</h2>
              <input placeholder="Admin Password" type="password" className="bg-black border border-zinc-700 rounded-xl p-3 w-full" value={adminPass} onChange={(e) => setAdminPass(e.target.value)} />
              <Button className="rounded-2xl w-full" onClick={handleAdminLogin}>Open Admin Panel</Button>
            </CardContent>
          </Card>
        )}

        {step === "admin" && (
          <Card className="bg-zinc-900 border-zinc-800">
            <CardContent className="space-y-4 p-6">
              <h2 className="text-xl font-semibold">ADMIN PANEL</h2>
              <div className="space-y-2">
                <h3 className="font-medium">Pending Access Requests</h3>
                {pendingAccess.length === 0 && <p className="text-sm text-zinc-400">No pending requests.</p>}
                <div className="space-y-2">
                  {pendingAccess.map((id) => (
                    <div key={id} className="flex items-center justify-between bg-black/60 rounded-xl p-3">
                      <span>{id}</span>
                      <div className="flex gap-2">
                        <Button onClick={() => approve(id)}>Approve</Button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
              <Button variant="outline" className="rounded-2xl" onClick={() => setStep("gate")}>Close Panel</Button>
            </CardContent>
          </Card>
        )}

        {step === "user" && (
          <div className="space-y-6">
            <Card className="bg-zinc-900 border-zinc-800">
              <CardContent className="space-y-4 p-6">
                <h2 className="text-xl font-semibold">Identity</h2>
                <p className="text-sm">Phone: {phone}</p>
                <p className="text-sm">Email: {email}</p>
              </CardContent>
            </Card>

            <Card className="bg-zinc-900 border-zinc-800">
              <CardContent className="space-y-4 p-6">
                <h2 className="text-xl font-semibold">Gallery</h2>
                <input type="file" multiple className="w-full rounded-xl bg-black border border-zinc-700 p-3" />
                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div className="rounded-2xl h-24 bg-zinc-800"></div>
                  <div className="rounded-2xl h-24 bg-zinc-800"></div>
                </div>
              </CardContent>
            </Card>

            <Card className="bg-zinc-900 border-zinc-800">
              <CardContent className="space-y-4 p-6">
                <h2 className="text-xl font-semibold">Communicate Box</h2>
                <div className="border border-zinc-700 rounded-2xl h-64 p-3 overflow-y-auto bg-black">Chat messages area</div>
                <div className="flex gap-2">
                  <input placeholder="Type a message" className="flex-1 rounded-xl p-3 bg-black border border-zinc-700" />
                  <Button>Send</Button>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                  <Button className="rounded-2xl">Voice Call</Button>
                  <Button className="rounded-2xl">Video Call</Button>
                  <Button className="rounded-2xl">Create Poll</Button>
                  <Button className="rounded-2xl">Share File</Button>
                </div>
                <p className="text-xs text-zinc-500">Note: Real-time chat, calls, and storage require backend services (e.g., WebRTC, signaling server, database).</p>
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}
